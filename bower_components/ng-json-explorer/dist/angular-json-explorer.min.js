angular.module("ngJsonExplorer",[]).directive("jsonExplorer",["$http",function(n){"use strict";return{restrict:"E",scope:{data:"=",jsonData:"@",url:"=",collapsed:"=",sortBy:"="},link:function(a,l,e){function s(n){var e=null;if(angular.isObject(n))e=n;else try{e=JSON.parse(n)}catch(s){return void(e={error:"invalid json"})}u(e)&&a.sortBy&&(e=e.sort(function(n,l){var e=a.sortBy.split(":"),s=e[0],r=e[1],t=n[s],i=l[s],o=function(n,a){return n-a},u=function(n,a){return n.length-a.length},c=null;if("number"==typeof t&&"number"==typeof i)c=o;else{if(!t.hasOwnProperty("length")||!i.hasOwnProperty("length"))return;c=u}return"asc"==r?c(t,i):"desc"==r?c(i,t):c(t,i)})),u(e)?h='[<ul class="array">':c(e)&&(h='{<ul class="object">');for(var r in e){var t=r,i=e[r];o(i)?h+="<li>"+p(t,i)+",</li>":u(i)?h+="<li>"+d(t,i)+",</li>":c(i)&&(h+="<li>"+f(t,i)+",</li>")}h=h.replace(/,<\/li>$/gim,"</li>"),u(e)?h+="</ul>]":c(e)&&(h+="</ul>}"),l.html('<div class="angular-json-explorer">'+h+"</div>");for(var g=l[0].getElementsByTagName("a"),v=0;v<g.length;v++){var m=g[v];angular.element(m).on("click",function(n){n.preventDefault();var a=angular.element(this).parent().next(),l=angular.element(this).parent().next().next();"+"==this.innerHTML?(a.addClass("hidden"),l.removeClass("hidden"),this.innerHTML="-"):(a.removeClass("hidden"),l.addClass("hidden"),this.innerHTML="+")})}}angular.isBoolean||(angular.isBoolean=function(n){return typeof n==Boolean});var r="+",t="",i="hidden";a.collapsed&&(r="-",t="hidden",i="");var o=function(n){return angular.isString(n)||angular.isNumber(n)||angular.isBoolean(n)||null===n},u=function(n){return angular.isArray(n)},c=function(n){return angular.isObject(n)},p=function(n,a){var l="";return n&&(l='<span class="prop>">'+n+"</span>: "),"string"==typeof a?l+'<span class="string">"'+a+'"</span>':"number"==typeof a?l+'<span class="num">'+a+"</span>":"boolean"==typeof a?l+'<span class="bool">'+a+"</span>":l+'<span class="null">'+a+"</span>"},d=function(n,a){var l='<span class="prop>"><a href="#" class="collapser">'+r+"</a></span> [";n&&(l='<span class="prop>"><a href="#" class="collapser">'+r+"</a>"+n+"</span>: ["),l+='<span class="ellipsis '+t+'">...</span>',l+='<ul class="array collapsible '+i+'">';for(var e=0;e<a.length;e++)o(a[e])?l+="<li>"+p(null,a[e])+",</li>":u(a[e])?l+="<li>"+d(null,a[e])+",</li>":c(a[e])&&(l+="<li>"+f(null,a[e])+",</li>");return l=l.replace(/,<\/li>$/gim,"</li>"),l+="</ul>",l+="]"},f=function(n,a){var l='<span class="prop>"><a href="#" class="collapser">'+r+"</a></span> {";n&&(l='<span class="prop>"><a href="#" class="collapser">'+r+"</a>"+n+"</span>: {"),l+='<span class="ellipsis '+t+'">...</span>',l+='<ul class="object collapsible '+i+'">';for(var e in a)o(a[e])?l+="<li>"+p(e,a[e])+",</li>":u(a[e])?l+="<li>"+d(e,a[e])+",</li>":c(a[e])&&(l+="<li>"+f(e,a[e])+",</li>");return l=l.replace(/,<\/li>$/gim,"</li>"),l+="</ul>",l+="}"},h="";a.$watch("url",function(l){l&&n.get(l).success(function(n){a.requestData=n})}),a.$watch("data",function(n){n&&s(n)}),a.$watch("jsonData",function(n){n&&s(n)}),a.$watch("requestData",function(n){n&&s(n)}),a.$watch("collapsed",function(n){if(void 0!=n)for(var a=l[0].getElementsByTagName("a"),e=0;e<a.length;e++){var s=a[e],r=angular.element(s).parent().next(),t=angular.element(s).parent().next().next();1==n?"-"==s.innerHTML&&(r.removeClass("hidden"),t.addClass("hidden"),s.innerHTML="+"):"+"==s.innerHTML&&(r.addClass("hidden"),t.removeClass("hidden"),s.innerHTML="-")}})}}}]);